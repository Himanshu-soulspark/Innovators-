<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Innovators Journey</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --dark-bg: #121212;
            --primary-yellow: #FFC107;
            --primary-red: #E53935;
            --card-bg: #1E1E1E;
            --text-light: #f0f0f0;
            --text-dark: #333;
            --input-bg: #2a2a2a;
        }

        body {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-light);
            overflow: hidden; /* Prevent scrollbars during transitions */
        }
        
        /* --- Page Transition Classes --- */
        .page {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            flex-direction: column;
            height: 100vh;
            box-sizing: border-box;
        }
        
        .page.visible {
            display: flex;
            opacity: 1;
        }

        /* --- Welcome Screen --- */
        #welcome-screen {
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }

        #welcome-screen h1 {
            font-size: 4rem;
            margin: 0;
            font-weight: 600;
            color: var(--text-light);
        }

        #welcome-screen h2 {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            margin: 10px 0 30px;
            color: var(--primary-yellow);
        }

        #welcome-screen img {
            max-width: 80%;
            width: 250px;
            height: auto;
            border-radius: 15px;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        /* Loader */
        .loader {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 5px solid #444;
            border-top-color: var(--primary-red);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* --- 3D Button Styles --- */
        #get-started-btn, .modal-btn, .submit-btn, .action-button {
            transition: transform 0.15s ease-out, box-shadow 0.15s ease-out !important;
        }

        #get-started-btn, .modal-btn.primary, .submit-btn, .action-button.yellow, .action-button.red {
            border-bottom: 4px solid #b46a00; /* Darker yellow/orange */
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }
        
        #get-started-btn:active, .modal-btn.primary:active, .submit-btn:active, .action-button:active {
             transform: translateY(4px);
             border-bottom-width: 0;
        }
        
        .modal-btn.secondary {
            border-bottom: 4px solid #222;
        }
         .modal-btn.secondary:active {
            transform: translateY(4px);
            border-bottom-width: 0;
        }

        /* Get Started Button */
        #get-started-btn {
            display: none;
            padding: 15px 35px;
            font-size: 1.2rem;
            font-weight: 600;
            background: linear-gradient(45deg, var(--primary-red), var(--primary-yellow));
            color: var(--text-dark);
            border-top: none;
            border-left: none;
            border-right: none;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 50px; /* Space for loader */
        }
        
        /* --- Custom Password Modal --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .modal-content {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            width: 90%;
            max-width: 400px;
            text-align: center;
            border-top: 3px solid var(--primary-yellow);
        }
        .modal-content h3 {
            margin-top: 0;
            color: var(--primary-yellow);
            font-size: 1.5rem;
        }
        .modal-content p {
            margin-bottom: 20px;
            font-size: 1rem;
        }
        .modal-input {
            width: 100%;
            padding: 12px;
            background-color: var(--input-bg);
            border: 1px solid #444;
            border-radius: 8px;
            color: var(--text-light);
            font-size: 1.2rem;
            box-sizing: border-box;
            text-align: center;
            letter-spacing: 5px;
        }
        .modal-error {
            color: var(--primary-red);
            margin-top: 10px;
            height: 20px;
            font-weight: 600;
        }
        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        .modal-btn {
            flex-grow: 1;
            padding: 12px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
        }
        .modal-btn.primary {
            background: linear-gradient(45deg, var(--primary-red), var(--primary-yellow));
            color: var(--text-dark);
        }
        .modal-btn.secondary {
            background: var(--input-bg);
            color: var(--text-light);
        }
        
        /* --- Common Top Bar for Dashboards --- */
        .top-bar {
            background: rgba(30, 30, 30, 0.8);
            backdrop-filter: blur(10px);
            color: white;
            padding: 15px;
            font-size: 1.5rem;
            font-weight: 600;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 2px solid var(--primary-yellow);
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .back-button {
            position: absolute;
            left: 15px;
            font-size: 1.8rem;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .back-button:hover {
            transform: scale(1.1);
        }
        .top-bar-action-btn {
            position: absolute;
            right: 15px;
            font-size: 0.9rem;
            padding: 8px 15px;
            background-color: var(--primary-yellow);
            color: var(--text-dark);
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        .top-bar-action-btn:hover {
             background-color: #ffca28;
        }
        
        /* --- Common Content Area --- */
        .content {
            padding: 90px 15px 20px;
            overflow-y: auto; /* Enable scrolling for content */
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        /* --- Main Dashboard --- */
        .card {
            background-color: var(--card-bg);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(255, 193, 7, 0.25);
        }

        .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s;
        }

        .card:hover .card-image {
            transform: scale(1.05);
        }

        .card-title {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 20px 15px;
            font-size: 1.3rem;
            font-weight: 600;
            color: white;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 100%);
            box-sizing: border-box;
        }
        
        .large-card { aspect-ratio: 16 / 9; margin-bottom: 20px; }
        .grid-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .small-card { aspect-ratio: 1 / 1; }

        /* --- User Dashboard & Details Page --- */
        .form-container, .details-container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
            width: 100%;
        }
        
        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-yellow);
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            background-color: var(--input-bg);
            border: 1px solid #444;
            border-radius: 8px;
            color: var(--text-light);
            font-size: 1rem;
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-yellow);
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.3);
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            background: linear-gradient(45deg, var(--primary-red), var(--primary-yellow));
            color: var(--text-dark);
            border: none;
            border-radius: 50px;
            cursor: pointer;
        }
        
        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: scale(1);
            box-shadow: none;
            border-bottom: none;
        }
        
        /* Details Page Specifics */
        .details-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 15px;
            margin-bottom: 30px;
            align-items: center;
        }
        .details-label { font-weight: 600; color: var(--primary-yellow); }
        .details-value { background: var(--input-bg); padding: 8px; border-radius: 5px; }

        .owner-boxes { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;}
        .owner-box { padding: 15px; border-radius: 8px; background: #2a2a2a; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .owner-box .form-label { margin-bottom: 5px; font-size: 0.9rem; }
        
        /* --- Common Table Styles --- */
        .table-container {
            width: 100%;
            overflow-x: auto; /* Enables horizontal scrolling */
            margin-top: 20px;
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 10px;
            flex-grow: 1;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px; /* Force horizontal scroll */
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #333;
            white-space: nowrap; /* Prevent text wrapping */
        }
        th {
            background-color: var(--primary-yellow);
            color: var(--text-dark);
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        tr:last-child td {
            border-bottom: none;
        }
        tr:nth-child(even) {
            background-color: #2a2a2a;
        }

        /* --- Get Leads Page & Table Action Styles --- */
        #get-leads-page .content {
            padding: 90px 5px 10px 5px; /* Adjust padding for full-width table */
        }
        .actions-cell {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .actions-cell a {
            color: var(--text-light);
            display: inline-block;
            transition: transform 0.2s ease, filter 0.2s ease;
        }
        .actions-cell a:hover {
            transform: scale(1.15);
            filter: brightness(1.2);
        }
        .actions-cell svg {
            width: 28px;
            height: 28px;
        }
        
        .bottom-actions {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            padding: 10px;
        }
        .action-button {
            flex: 1;
            padding: 15px;
            border-radius: 10px;
            border: none;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
        }
        .action-button.red {
            background-color: var(--primary-red);
            color: var(--text-light);
            border-bottom-color: #a02725;
        }
        .action-button.yellow {
            background-color: var(--primary-yellow);
            color: var(--text-dark);
        }
        
        /* --- Stock Selection Page --- */
        .stock-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }
        .stock-item {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
            border-left: 5px solid var(--primary-yellow);
        }
        .stock-item:hover {
            background-color: #2a2a2a;
            transform: translateX(5px);
        }

        /* --- Responsive Styles --- */
        @media (max-width: 600px) {
            #welcome-screen h1 { font-size: 3rem; }
            #welcome-screen h2 { font-size: 2rem; }
            .card-title { font-size: 1.1rem; padding: 15px 10px; }
            .owner-boxes { grid-template-columns: 1fr; }
            .content { padding: 80px 10px 10px; }
            .top-bar { padding: 15px 10px; }
            .back-button { left: 10px; }
            .top-bar-action-btn { right: 10px; }
            .modal-content { padding: 20px; }
        }

        @media (min-width: 768px) {
             .content { padding: 90px 40px 40px; }
             .grid-container { grid-template-columns: repeat(4, 1fr); gap: 20px; }
             .large-card { grid-column: 1 / 3; }
             #dashboard .content { max-width: 1200px; margin: 0 auto; }
        }
    </style>
</head>
<body>

    <!-- Welcome Screen -->
    <div id="welcome-screen" class="page visible">
        <h1>Welcome</h1>
        <h2>Innovators</h2>
        <img src="https://i.ibb.co/B28vDXyY/Picsart-25-10-03-23-08-07-196.png" alt="Innovators Welcome Image">
        <div class="loader" id="loader"></div>
        <button id="get-started-btn">Get Started</button>
    </div>
    
    <!-- Custom Password Modal -->
    <div id="password-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Verification Required</h3>
            <p>Please enter the innovator password to continue.</p>
            <input type="password" id="password-input" class="modal-input" placeholder="****">
            <div id="password-error" class="modal-error"></div>
            <div class="modal-buttons">
                <button id="password-cancel" class="modal-btn secondary">Cancel</button>
                <button id="password-submit" class="modal-btn primary">Verify</button>
            </div>
        </div>
    </div>
    
    <!-- Bank Details Modal -->
    <div id="bank-details-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Add / Update Bank Details</h3>
            <div class="form-container" style="box-shadow: none; padding: 0; margin: 20px 0;">
                <div class="form-group">
                    <input type="tel" id="bank-mobile" class="form-input" placeholder="Mobile No." maxlength="10">
                </div>
                 <div class="form-group">
                    <input type="text" id="bank-account" class="form-input" placeholder="Account Number">
                </div>
                 <div class="form-group">
                    <input type="text" id="bank-ifsc" class="form-input" placeholder="IFSC Code">
                </div>
                 <div class="form-group">
                    <input type="text" id="bank-upi" class="form-input" placeholder="UPI ID">
                </div>
                 <div class="form-group" style="margin-bottom: 0;">
                    <input type="text" id="bank-pan" class="form-input" placeholder="PAN No.">
                </div>
            </div>
            <div class="modal-buttons">
                <button id="bank-details-cancel" class="modal-btn secondary">Cancel</button>
                <button id="bank-details-update" class="modal-btn primary">Update</button>
            </div>
        </div>
    </div>


    <!-- Main Dashboard -->
    <div id="dashboard" class="page">
        <div class="top-bar">Innovator Journey</div>
        <div class="content">
            <div id="get-leads-card" class="card large-card">
                <img src="https://i.ibb.co/DHSKPfmY/W5tmz-Cyi-Rc-OOjm-Tb-NSP-3w.webp" alt="Get Leads" class="card-image">
                <div class="card-title">Get Leads</div>
            </div>
            <div class="grid-container">
                <div id="user-card" class="card small-card">
                    <img src="https://i.ibb.co/JW4RJBC1/6-Fzqgi0o-Q4-Soa-F6c-Qbexw.jpg" alt="User" class="card-image">
                    <div class="card-title">User</div>
                </div>
                <div id="details-card" class="card small-card"><img src="https://i.ibb.co/4RMVrJ0M/Lucid-Origin-A-futuristic-workspace-where-a-data-scientist-is-0.jpg" alt="Details" class="card-image"><div class="card-title">Get Details</div></div>
            </div>
        </div>
    </div>
    
    <!-- Get Leads Page -->
    <div id="get-leads-page" class="page">
        <div class="top-bar">
            <div class="back-button" id="back-to-main-dashboard-3">‹</div>
            Get Leads
        </div>
        <div class="content" id="leads-list-container">
             <!-- Lead table will be inserted here by JavaScript from Firebase -->
        </div>
    </div>

    <!-- User Dashboard Page -->
    <div id="user-dashboard" class="page">
        <div class="top-bar">
             <div class="back-button" id="back-to-main-dashboard-1">‹</div>
            User Dashboard
        </div>
        <div class="content">
            <div class="form-container">
                <div class="form-group">
                    <label class="form-label" for="portal-select">Select Portal</label>
                    <select id="portal-select" class="form-select">
                        <option value="">--Select Portal--</option>
                        <option value="angel-one">Angel-One</option>
                        <option value="angel-one-non-trade">Angel-One(Non-Trade)</option>
                        <option value="m-stock">M-Stock</option>
                        <option value="hdfc">HDFC</option>
                        <option value="upstox">Upstox</option>
                        <option value="aditya-birla">Aditya Birla</option>
                        <option value="lemon-money">Lemon Money</option>
                        <option value="paytm-money">Paytm Money</option>
                        <option value="fi-money">FI-Money</option>
                        <option value="axis">Axis</option>
                        <option value="bajaj-mf">Bajaj MF</option>
                        <option value="bajaj-demat">Bajaj Demat</option>
                        <option value="airtel-payment-bank">Airtel Payment Bank</option>
                        <option value="idfc-bank">IDFC Bank</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="client-code">Client Code (Optional)</label>
                    <input type="text" id="client-code" class="form-input" placeholder="Enter client code">
                </div>
                 <div class="form-group">
                    <label class="form-label" for="mobile-no">Mobile No.</label>
                    <input type="tel" id="mobile-no" class="form-input" placeholder="Enter mobile number" maxlength="10">
                </div>
                <button id="submit-details-btn" class="submit-btn" disabled>Submit</button>
            </div>
        </div>
    </div>
    
    <!-- User Details Page -->
    <div id="details-page" class="page">
        <div class="top-bar">
            <div class="back-button" id="back-to-user-form">‹</div>
            User Details
        </div>
        <div class="content">
            <div class="details-container">
                <div class="details-grid">
                    <div class="details-label">Name:</div>
                    <div class="details-value" id="detail-name">N/A</div>
                    <div class="details-label">Mobile No.:</div>
                    <div class="details-value" id="detail-mobile">N/A</div>
                    <div class="details-label">Client ID:</div>
                    <div class="details-value" id="detail-client-id">N/A</div>
                    <div class="details-label">e-KYC Stage:</div>
                    <div class="details-value" id="detail-kyc">N/A</div>
                    <div class="details-label">Trade Status:</div>
                    <div class="details-value" id="detail-trade">N/A</div>
                </div>
                <div class="owner-boxes">
                    <div class="owner-box">
                        <label class="form-label">Owner Name</label>
                        <input type="text" id="owner-name-input" class="form-input" value="Innovator A">
                    </div>
                    <div class="owner-box">
                        <label class="form-label">Owner Mobile No.</label>
                        <input type="tel" id="owner-mobile-input" class="form-input" value="9876543210" maxlength="10">
                    </div>
                </div>
                <button id="update-owner-btn" class="submit-btn" disabled>Update</button>
            </div>
        </div>
    </div>
    
    <!-- Get Details Page -->
    <div id="get-details-page" class="page">
        <div class="top-bar">
            <div class="back-button" id="back-to-main-dashboard-2">‹</div>
            Get Details
            <div id="add-bank-details-btn" class="top-bar-action-btn">Add Bank Details</div>
        </div>
        <div class="content">
            <div class="table-container">
                <table id="bank-details-table">
                    <thead>
                        <tr>
                            <th>Mobile No.</th>
                            <th>Account Number</th>
                            <th>IFSC Code</th>
                            <th>UPI ID</th>
                            <th>PAN No.</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be inserted here by JavaScript from Firebase -->
                    </tbody>
                </table>
            </div>
            <div class="bottom-actions">
                <button id="stock-btn" class="action-button red">Stock</button>
                <button class="action-button yellow">Total Amount</button>
            </div>
        </div>
    </div>
    
    <!-- Stock Selection Page -->
    <div id="stock-selection-page" class="page">
        <div class="top-bar">
            <div class="back-button" id="back-to-get-details">‹</div>
            Select Stock
        </div>
        <div class="content">
            <div class="stock-list" id="stock-list-container">
                <!-- Stock items will be generated by JavaScript -->
            </div>
        </div>
    </div>
    
     <!-- Stock Details Page -->
    <div id="stock-details-page" class="page">
        <div class="top-bar">
            <div class="back-button" id="back-to-stock-selection">‹</div>
            <span id="stock-details-title">Stock Details</span>
        </div>
        <div class="content">
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Serial No.</th>
                            <th>Client Name</th>
                            <th>Owner Name</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>John Doe</td>
                            <td>Innovator A</td>
                        </tr>
                         <tr>
                            <td>2</td>
                            <td>Jane Smith</td>
                            <td>Innovator B</td>
                        </tr>
                        <!-- More dummy data -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, onValue, push, set } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";
        
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBjlgKJDXdzZ3CwknhmjWF6nWqJxvnluJA",
            authDomain: "webs-60171.firebaseapp.com",
            databaseURL: "https://webs-60171-default-rtdb.firebaseio.com",
            projectId: "webs-60171",
            storageBucket: "webs-60171.appspot.com", // Corrected storage bucket URL
            messagingSenderId: "409682548143",
            appId: "1:409682548143:web:66e6ca40b22af3b2354b5a",
            measurementId: "G-CE0XKCC30Q"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // --- All existing JavaScript code is now inside this module script ---

        // --- Page Elements ---
        const pages = {
            welcome: document.getElementById('welcome-screen'),
            dashboard: document.getElementById('dashboard'),
            getLeads: document.getElementById('get-leads-page'),
            userDashboard: document.getElementById('user-dashboard'),
            details: document.getElementById('details-page'),
            getDetails: document.getElementById('get-details-page'),
            stockSelection: document.getElementById('stock-selection-page'),
            stockDetails: document.getElementById('stock-details-page')
        };
        
        // --- Modal Elements ---
        const passwordModal = document.getElementById('password-modal');
        const bankDetailsModal = document.getElementById('bank-details-modal');

        // --- Buttons & Interactive Elements ---
        const loader = document.getElementById('loader');
        const getStartedBtn = document.getElementById('get-started-btn');
        const getLeadsCard = document.getElementById('get-leads-card');
        const userCard = document.getElementById('user-card');
        const detailsCard = document.getElementById('details-card');
        const mobileInput = document.getElementById('mobile-no');
        const submitDetailsBtn = document.getElementById('submit-details-btn');
        const updateOwnerBtn = document.getElementById('update-owner-btn');
        const ownerNameInput = document.getElementById('owner-name-input');
        const ownerMobileInput = document.getElementById('owner-mobile-input');
        const addBankDetailsBtn = document.getElementById('add-bank-details-btn');
        const stockBtn = document.getElementById('stock-btn');

        const portalOptions = [
            { value: "angel-one", text: "Angel-One" }, { value: "angel-one-non-trade", text: "Angel-One(Non-Trade)" },
            { value: "m-stock", text: "M-Stock" }, { value: "hdfc", text: "HDFC" }, { value: "upstox", text: "Upstox" },
            { value: "aditya-birla", text: "Aditya Birla" }, { value: "lemon-money", text: "Lemon Money" },
            { value: "paytm-money", text: "Paytm Money" }, { value: "fi-money", text: "FI-Money" }, { value: "axis", text: "Axis" },
            { value: "bajaj-mf", text: "Bajaj MF" }, { value: "bajaj-demat", text: "Bajaj Demat" },
            { value: "airtel-payment-bank", text: "Airtel Payment Bank" }, { value: "idfc-bank", text: "IDFC Bank" }
        ];

        // --- Function to switch between pages ---
        function showPage(pageToShow) {
            Object.values(pages).forEach(p => p.classList.remove('visible'));
            pageToShow.classList.add('visible');
            document.body.style.overflow = 'auto';
        }
        
        function showModal(modal) {
            modal.style.display = 'flex';
        }
        function hideModal(modal) {
            modal.style.display = 'none';
        }

        // 1. Welcome Screen & Password Modal Logic
        setTimeout(() => {
            loader.style.display = 'none';
            getStartedBtn.style.display = 'inline-block';
        }, 3000);

        getStartedBtn.addEventListener('click', () => {
            showModal(passwordModal);
            document.getElementById('password-input').focus();
        });
        
        document.getElementById('password-cancel').addEventListener('click', () => hideModal(passwordModal));
        
        document.getElementById('password-submit').addEventListener('click', () => {
            const passwordInput = document.getElementById('password-input');
            const passwordError = document.getElementById('password-error');
            if (passwordInput.value === "2025") {
                hideModal(passwordModal);
                pages.welcome.classList.remove('visible');
                setTimeout(() => showPage(pages.dashboard), 500);
                passwordInput.value = '';
                passwordError.textContent = '';
            } else {
                passwordError.textContent = "Incorrect Password";
                passwordModal.querySelector('.modal-content').style.animation = 'shake 0.5s';
                setTimeout(() => {
                     passwordModal.querySelector('.modal-content').style.animation = '';
                }, 500);
            }
        });

        // 2. Main Dashboard Navigation
        getLeadsCard.addEventListener('click', () => {
            listenForLeads(); // Start listening to Firebase for leads
            pages.dashboard.classList.remove('visible');
            setTimeout(() => showPage(pages.getLeads), 500);
        });

        userCard.addEventListener('click', () => {
            pages.dashboard.classList.remove('visible');
            setTimeout(() => showPage(pages.userDashboard), 500);
        });
        
        detailsCard.addEventListener('click', () => {
            listenForBankDetails(); // Start listening to Firebase for bank details
            pages.dashboard.classList.remove('visible');
            setTimeout(() => showPage(pages.getDetails), 500);
        });

        // 3. Get Leads Page Logic (Table View from Firebase)
        function listenForLeads() {
            const container = document.getElementById('leads-list-container');
            const leadsRef = ref(database, 'leads');

            onValue(leadsRef, (snapshot) => {
                container.innerHTML = ''; // Clear previous data
                const leadsData = snapshot.val();

                if (!leadsData) {
                    container.innerHTML = '<p style="text-align: center;">No leads found.</p>';
                    return;
                }

                const whatsappIconSVG = `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#4ade80"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M16.5 13.5C16.5 13.5 15 15 12 15C9 15 7.5 13.5 7.5 13.5" stroke="#25D366" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M12 2C6.47715 2 2 6.47715 2 12C2 13.8551 2.53633 15.5943 3.47321 17.0712L2 22L6.92882 20.5268C8.40571 21.4637 10.1449 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2Z" stroke="#25D366" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M9 10.5C9.27614 10.5 9.5 10.2761 9.5 10C9.5 9.72386 9.27614 9.5 9 9.5C8.72386 9.5 8.5 9.72386 8.5 10C8.5 10.2761 8.72386 10.5 9 10.5Z" fill="#25D366"></path> <path d="M15 10.5C15.2761 10.5 15.5 10.2761 15.5 10C15.5 9.72386 15.2761 9.5 15 9.5C14.7239 9.5 14.5 9.72386 14.5 10C14.5 10.2761 14.7239 10.5 15 10.5Z" fill="#25D366"></path> </g></svg>`;
                const callIconSVG = `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M14.5 6.5C15.2376 7.24432 15.8236 8.1458 16.222 9.13824C16.6203 10.1307 16.8228 11.192 16.8228 12.2727C16.8228 13.3534 16.6203 14.4147 16.222 15.4072C15.8236 16.3996 15.2376 17.3011 14.5 18.0454M18.3 2.72723C19.4639 3.90046 20.4074 5.29399 21.0844 6.8268C21.7615 8.35961 22.1611 10.0033 22.261 11.6818C22.361 13.3602 22.1585 15.0441 21.6641 16.6454C21.1698 18.2467 20.3934 19.741 19.375 20.9091M8.11364 12.2727H12.25M12.25 12.2727V8.13632M12.25 12.2727V16.4091M12.25 12.2727H8.11364M3.88636 12.2727H2M9.25 3.88632L7.02273 1.65905M9.25 20.659L7.02273 22.8863" stroke="#64b5f6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>`;

                const tableContainer = document.createElement('div');
                tableContainer.className = 'table-container';
                const table = document.createElement('table');
                table.innerHTML = `<thead>...</thead><tbody></tbody>`;
                table.querySelector('thead').innerHTML = `
                    <tr>
                        <th>Actions</th>
                        <th>Name</th>
                        <th>Code</th>
                        <th>Mobile No.</th>
                        <th>Age</th>
                        <th>Address</th>
                        <th>Qualification</th>
                    </tr>`;
                const tableBody = table.querySelector('tbody');

                for (const leadId in leadsData) {
                    const lead = leadsData[leadId];
                    const row = tableBody.insertRow();
                    row.innerHTML = `
                        <td class="actions-cell">
                            <a href="https://wa.me/91${lead.mobile || ''}" target="_blank" title="WhatsApp">${whatsappIconSVG}</a>
                            <a href="tel:${lead.mobile || ''}" title="Call">${callIconSVG}</a>
                        </td>
                        <td>${lead.name || 'N/A'}</td>
                        <td>${lead.code || 'N/A'}</td>
                        <td>${lead.mobile || 'N/A'}</td>
                        <td>${lead.age || 'N/A'}</td>
                        <td>${lead.address || 'N/A'}</td>
                        <td>${lead.qualification || 'N/A'}</td>
                    `;
                }

                tableContainer.appendChild(table);
                container.appendChild(tableContainer);
            });
        }

        // 4. User Dashboard Logic (Submit to Firebase)
        mobileInput.addEventListener('input', () => {
            submitDetailsBtn.disabled = mobileInput.value.length !== 10;
        });
        
        submitDetailsBtn.addEventListener('click', () => {
            const portal = document.getElementById('portal-select').value;
            const clientCode = document.getElementById('client-code').value;
            const mobileNo = document.getElementById('mobile-no').value;

            // Push data to Firebase
            const userSubmissionsRef = ref(database, 'userSubmissions');
            push(userSubmissionsRef, {
                portal: portal,
                clientCode: clientCode,
                mobile: mobileNo,
                timestamp: new Date().toISOString()
            }).then(() => {
                // Show details on the next page (for user feedback)
                document.getElementById('detail-mobile').textContent = mobileNo;
                document.getElementById('detail-name').textContent = "John Doe (Fetched)"; // Example
                document.getElementById('detail-client-id').textContent = clientCode || 'N/A';
                document.getElementById('detail-kyc').textContent = "Pending";
                document.getElementById('detail-trade').textContent = "Inactive";
                pages.userDashboard.classList.remove('visible');
                setTimeout(() => showPage(pages.details), 500);
            }).catch((error) => {
                console.error("Error writing to Firebase: ", error);
                alert("Failed to submit details. Please try again.");
            });
        });
        
        // 5. User Details Page (Update Owner Info to Firebase)
        function checkOwnerInputs() {
            const isNameValid = ownerNameInput.value.trim() !== '';
            const isMobileValid = ownerMobileInput.value.length === 10;
            updateOwnerBtn.disabled = !(isNameValid && isMobileValid);
        }
        ownerNameInput.addEventListener('input', checkOwnerInputs);
        ownerMobileInput.addEventListener('input', checkOwnerInputs);

        updateOwnerBtn.addEventListener('click', () => {
             const ownerDetails = {
                name: ownerNameInput.value.trim(),
                mobile: ownerMobileInput.value,
                associatedClientMobile: document.getElementById('detail-mobile').textContent,
                timestamp: new Date().toISOString()
            };

            const ownerDetailsRef = ref(database, 'ownerDetails');
            push(ownerDetailsRef, ownerDetails).then(() => {
                alert("Owner details updated successfully!");
                showPage(pages.dashboard);
            }).catch((error) => {
                console.error("Error updating owner details: ", error);
                alert("Failed to update details. Please try again.");
            });
        });

        // 6. "Get Details" Page Logic (Bank Details with Firebase)
        addBankDetailsBtn.addEventListener('click', () => showModal(bankDetailsModal));
        document.getElementById('bank-details-cancel').addEventListener('click', () => hideModal(bankDetailsModal));
        
        document.getElementById('bank-details-update').addEventListener('click', () => {
            const newEntry = {
                mobile: document.getElementById('bank-mobile').value,
                account: document.getElementById('bank-account').value,
                ifsc: document.getElementById('bank-ifsc').value,
                upi: document.getElementById('bank-upi').value,
                pan: document.getElementById('bank-pan').value,
            };

            // Push to Firebase instead of local array
            const bankDetailsRef = ref(database, 'bankDetails');
            push(bankDetailsRef, newEntry).then(() => {
                 hideModal(bankDetailsModal);
                // Clear form
                bankDetailsModal.querySelectorAll('.form-input').forEach(input => input.value = '');
            }).catch((error) => {
                 console.error("Error adding bank details: ", error);
                 alert("Failed to add details. Please try again.");
            });
        });
        
        function listenForBankDetails() {
            const tableBody = document.getElementById('bank-details-table').querySelector('tbody');
            const bankDetailsRef = ref(database, 'bankDetails');

            onValue(bankDetailsRef, (snapshot) => {
                tableBody.innerHTML = ''; // Clear existing rows
                const data = snapshot.val();
                if (data) {
                    for (const key in data) {
                        const detail = data[key];
                        const row = tableBody.insertRow();
                        row.innerHTML = `
                            <td>${detail.mobile || 'N/A'}</td>
                            <td>${detail.account || 'N/A'}</td>
                            <td>${detail.ifsc || 'N/A'}</td>
                            <td>${detail.upi || 'N/A'}</td>
                            <td>${detail.pan || 'N/A'}</td>
                        `;
                    }
                }
            });
        }

        // 7. Stock Pages Logic (No change needed, as it's static)
        stockBtn.addEventListener('click', () => {
            populateStockList();
            pages.getDetails.classList.remove('visible');
            setTimeout(() => showPage(pages.stockSelection), 500);
        });
        
        function populateStockList() {
            const container = document.getElementById('stock-list-container');
            container.innerHTML = '';
            portalOptions.forEach(option => {
                const stockDiv = document.createElement('div');
                stockDiv.className = 'stock-item';
                stockDiv.textContent = option.text;
                stockDiv.dataset.stockName = option.text;
                stockDiv.addEventListener('click', (e) => {
                    const stockName = e.target.dataset.stockName;
                    document.getElementById('stock-details-title').textContent = stockName;
                    pages.stockSelection.classList.remove('visible');
                    setTimeout(() => showPage(pages.stockDetails), 500);
                });
                container.appendChild(stockDiv);
            });
        }

        // 8. Back Button Navigation
        document.getElementById('back-to-main-dashboard-1').addEventListener('click', () => showPage(pages.dashboard));
        document.getElementById('back-to-main-dashboard-2').addEventListener('click', () => showPage(pages.dashboard));
        document.getElementById('back-to-main-dashboard-3').addEventListener('click', () => showPage(pages.dashboard));
        document.getElementById('back-to-user-form').addEventListener('click', () => showPage(pages.userDashboard));
        document.getElementById('back-to-get-details').addEventListener('click', () => showPage(pages.getDetails));
        document.getElementById('back-to-stock-selection').addEventListener('click', () => showPage(pages.stockSelection));
    </script>

</body>
</html>
